# java-filmorate

Приложение для рекомендации фильмов и работы с пользовательскими оценками. Сервис предоставляет REST API для добавления, обновления и получения информации о фильмах и пользователях, а также формирует топ-5 рекомендованных фильмов.

**Основные возможности:**

- Фильмы - добавление, поиск, обновление и удаление
- Лайки - система оценок для формирования рейтинга
- Социальная сеть - друзья, общие интересы, списки любимых фильмов
- Каталогизация - жанры и рейтинги MPA
- Топ-подборки - самые популярные фильмы по оценкам

**Ключевые особенности:**

- Валидация данных - проверка входных запросов на уровне контроллеров
- REST API - четкое разделение DTO и сущностей с мапперами
- Гибкие запросы - поиск фильмов по жанрам, рейтингам и популярности
- Социальные функции - система друзей и общих интересов

**Технологический стек:**

- Backend: Java 21, Spring Boot (Web, JDBC Template)
- База данных: PostgreSQL
- Архитектура: монолитная (единое приложение) с четким разделением слоев. RESTful API (стандартные HTTP-методы и статусы)
- Тестирование: JUnit, Postman
- Сборка: Maven

### Схема базы данных проекта:

![Схема базы данных проекта](/assets/db_scheme/filmorate_SQL_scheme.png)

### Описание схемы базы данных проекта:

#### `films`

Таблица содержит информацию о каждом фильме и состоит из полей:

- `id` - идентификатор фильма (**первичный ключ**)
- `name` - название фильма
- `description` - описание фильма
- `release_date` - дата релиза фильма
- `duration` - продолжительность фильма
- `rating_id` - рейтинг Ассоциации кинокомпаний/идентификатор рейтинга для таблицы `mpa-rating`

#### `mpa-rating`

Таблица содержит информацию о возрастном ограничении для фильма и состоит из полей:

- `id` - идентификатор рейтинга (**первичный ключ**)
- `name` - название рейтинга

#### `genres`

Таблица содержит информацию о жанрах фильма и состоит из полей:

- `id` - идентификатор жанра (**первичный ключ**)
- `name` - название жанра

#### `film-genres`

Таблица содержит информацию о жанрах (из таблицы `genres`) фильма (из таблицы `films`) и состоит из полей:

- `film_id` - идентификатор фильма (**первичный ключ составной**)
- `genre_id` - идентификатор жанра (**первичный ключ составной**)

#### `film-likes`

Таблица содержит информацию о лайке пользователя (из таблицы `users`) к фильму (из таблицы `films`) и состоит из полей:

- `film_id` - идентификатор фильма (**первичный ключ составной**)
- `user_id` - идентификатор пользователя (**первичный ключ составной**)

#### `users`

Таблица содержит информацию о каждом пользователе и состоит из полей:

- `id` - идентификатор пользователя (**первичный ключ**)
- `email` - электронная почта пользователя
- `login` - логин пользователя
- `name` - имя пользователя для отображения
- `birthday` - дата рождения пользователя

#### `friendship`

Таблица содержит информацию о дружбе пользователей (из таблицы `users`) и состоит из полей:

- `inviter_id` - идентификатор пользователя, отправляющего запрос на добавление в друзья (**первичный ключ составной**)
- `invitee_id` - идентификатор пользователя, получающего запрос на добавление в друзья (**первичный ключ составной**)
- `status` - статус запроса (REQUESTED/DECLINED/APPROVED)

### Примеры запросов к базе данных для основных операций приложения:

- Получение списка всех пользователей:
```sql
SELECT * FROM users;
```
- Добавление нового пользователя:
```sql
INSERT INTO users (email, login, name, birthday)
VALUES ('mail@yandex.ru', 'user', 'Иванов', '1900-01-01');
```
- Получение списка друзей пользователя с id = 1:
```sql
SELECT u.login FROM users AS u
JOIN friendship f ON u.id = f.invitee_id 
WHERE f.inviter_id = 1
AND status = 'APPROVED';
```
- Удаление пользователя с id = 1:
```sql
DELETE FROM users
WHERE id = 1;
```
- Получение 10 самых популярных фильмов:
```sql
SELECT f.name FROM films AS f
JOIN film_likes AS fl ON f.id = fl.film_id
GROUP BY f.id, f.name
ORDER BY COUNT(fl.user_id) DESC
LIMIT 10;
```
